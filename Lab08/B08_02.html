<!doctype html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>B08_02 — Список покупок (розширений)</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f7f7fb; }
    .card { border: 0; box-shadow: 0 8px 24px rgba(0,0,0,.08); }
    .bought { color: #6c757d; text-decoration: line-through; }
    .pill { font-size: .8rem; }
  </style>
</head>
<body>
  <div id="app" class="container py-4" style="max-width: 980px;">
    <div class="card">
      <div class="card-body">
        <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
          <h3 class="mb-0">Список покупок</h3>

          <div class="btn-group">
            <button class="btn btn-outline-dark" :class="{ active: filter === 'all' }" @click="filter='all'">Усі</button>
            <button class="btn btn-outline-dark" :class="{ active: filter === 'bought' }" @click="filter='bought'">Куплені</button>
            <button class="btn btn-outline-dark" :class="{ active: filter === 'notBought' }" @click="filter='notBought'">Не куплені</button>
          </div>
        </div>

        <div class="row g-2 align-items-end">
          <div class="col-12 col-md-6">
            <label class="form-label">Назва покупки</label>
            <input class="form-control" v-model.trim="newName" placeholder="Наприклад: молоко">
          </div>

          <div class="col-12 col-md-3">
            <label class="form-label">Вартість (₴)</label>
            <input class="form-control" v-model="newPrice" type="number" min="0" step="0.01" placeholder="0">
          </div>

          <div class="col-12 col-md-3">
            <button class="btn btn-primary w-100" @click="addItem">Додати</button>
          </div>
        </div>

        <hr class="my-4">

        <div v-if="items.length === 0" class="alert alert-secondary">
          Список порожній
        </div>

        <div v-else>
          <div v-if="filteredItems.length === 0" class="alert alert-warning">
            Немає покупок для відображення
          </div>

          <ul v-else class="list-group">
            <li v-for="item in filteredItems" :key="item.id" class="list-group-item">
              <div class="d-flex flex-wrap justify-content-between align-items-start gap-2">
                <div class="me-auto">
                  <div class="fw-semibold" :class="{ bought: item.bought }">
                    {{ item.name }}
                    <span class="badge bg-light text-dark border pill ms-2">
                      {{ formatPrice(item.price) }}
                    </span>
                  </div>

                  <div class="text-muted small mt-1">
                    Дата покупки:
                    <span v-if="item.date">{{ item.date }}</span>
                    <span v-else>—</span>
                  </div>
                </div>

                <div class="d-flex gap-2">
                  <button class="btn btn-sm btn-outline-success" @click="toggleBought(item)">
                    {{ item.bought ? "Скасувати" : "Куплено" }}
                  </button>
                  <button class="btn btn-sm btn-outline-danger" @click="removeItem(item.id)">
                    Видалити
                  </button>
                </div>
              </div>
            </li>
          </ul>

          <div class="d-flex flex-wrap justify-content-between align-items-center mt-3 gap-2">
            <div class="fw-semibold">
              Загальна сума куплених: {{ formatPrice(totalBought) }}
            </div>
            <div class="text-muted small">
              Виконано {{ boughtCount }} із {{ items.length }} покупок
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          newName: "",
          newPrice: "",
          filter: "all",
          items: []
        };
      },
      computed: {
        filteredItems() {
          if (this.filter === "bought") return this.items.filter(i => i.bought);
          if (this.filter === "notBought") return this.items.filter(i => !i.bought);
          return this.items;
        },
        totalBought() {
          return this.items
            .filter(i => i.bought)
            .reduce((sum, i) => sum + (Number(i.price) || 0), 0);
        },
        boughtCount() {
          return this.items.filter(i => i.bought).length;
        }
      },
      methods: {
        nowString() {
          return new Date().toLocaleString("uk-UA", {
            year: "numeric",
            month: "2-digit",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit"
          });
        },
        formatPrice(v) {
          const n = Number(v) || 0;
          return n.toFixed(2) + " ₴";
        },
        addItem() {
          const name = this.newName.trim();
          if (!name) return;

          let price = Number(this.newPrice);
          if (!Number.isFinite(price) || price < 0) price = 0;

          this.items.push({
            id: crypto.randomUUID(),
            name,
            bought: false,
            price,
            date: null
          });

          this.newName = "";
          this.newPrice = "";
        },
        toggleBought(item) {
          item.bought = !item.bought;
          item.date = item.bought ? this.nowString() : null;
        },
        removeItem(id) {
          this.items = this.items.filter(i => i.id !== id);
        }
      }
    }).mount("#app");
  </script>
</body>
</html>
